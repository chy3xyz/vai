<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAI Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f23; color: #e0e0e0; min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 40px 0; border-bottom: 1px solid #333; }
        header h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        header p { color: #888; font-size: 1.1em; }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin-top: 30px;
        }
        .card {
            background: #1a1a2e; border-radius: 12px; padding: 24px;
            border: 1px solid #2d2d44;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.2);
        }
        .card h2 {
            font-size: 1.2em; margin-bottom: 16px; color: #667eea;
            display: flex; align-items: center; gap: 10px;
        }
        .status-indicator {
            display: inline-block; width: 8px; height: 8px;
            border-radius: 50%; background: #4caf50;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .metric {
            display: flex; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid #2d2d44;
        }
        .metric:last-child { border-bottom: none; }
        .metric-value { font-size: 1.5em; font-weight: bold; color: #667eea; }
        .agent-list { max-height: 300px; overflow-y: auto; }
        .agent-item {
            display: flex; align-items: center; padding: 12px;
            background: #16162a; border-radius: 8px; margin-bottom: 8px;
            cursor: pointer; transition: background 0.2s;
        }
        .agent-item:hover { background: #1f1f3a; }
        .agent-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; margin-right: 12px;
        }
        .agent-info { flex: 1; }
        .agent-name { font-weight: 500; }
        .agent-role { font-size: 0.85em; color: #888; }
        .agent-status { width: 10px; height: 10px; border-radius: 50%; background: #4caf50; }
        .agent-status.busy { background: #ff9800; }
        .agent-status.offline { background: #f44336; }
        .chat-container { grid-column: 1 / -1; height: 500px; display: flex; flex-direction: column; }
        .chat-messages {
            flex: 1; overflow-y: auto; padding: 16px;
            background: #0f0f1a; border-radius: 8px; margin-bottom: 16px;
        }
        .message { margin-bottom: 16px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-header {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 4px; font-size: 0.85em; color: #888;
        }
        .message-content {
            background: #1a1a2e; padding: 12px 16px;
            border-radius: 12px; border-left: 3px solid #667eea;
        }
        .message.user .message-content { border-left-color: #4caf50; }
        .chat-input { display: flex; gap: 12px; }
        .chat-input input {
            flex: 1; padding: 14px 18px; background: #1a1a2e;
            border: 1px solid #2d2d44; border-radius: 8px;
            color: #e0e0e0; font-size: 1em; outline: none;
        }
        .chat-input input:focus { border-color: #667eea; }
        .chat-input button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; border-radius: 8px; color: white;
            font-weight: 500; cursor: pointer;
        }
        .log-container { max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.85em; }
        .log-entry { padding: 6px 0; border-bottom: 1px solid #2d2d44; color: #888; }
        .log-entry.error { color: #f44336; }
        .log-entry.warn { color: #ff9800; }
        .log-entry.info { color: #4caf50; }
        .actions { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }
        .btn {
            padding: 10px 20px; background: #1a1a2e;
            border: 1px solid #2d2d44; border-radius: 6px;
            color: #e0e0e0; cursor: pointer;
        }
        .btn:hover { background: #2d2d44; border-color: #667eea; }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>VAI Dashboard</h1>
            <p>V AI Infrastructure - Multi-Agent System Console</p>
        </header>
        
        <div class="actions">
            <button class="btn btn-primary" onclick="refreshData()">Refresh</button>
            <button class="btn" onclick="createAgent()">New Agent</button>
            <button class="btn" onclick="broadcastMessage()">Broadcast</button>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h2><span class="status-indicator"></span>System Status</h2>
                <div class="metric"><span>Agents Online</span><span class="metric-value" id="agents-online">0</span></div>
                <div class="metric"><span>Active Tasks</span><span class="metric-value" id="active-tasks">0</span></div>
                <div class="metric"><span>Uptime</span><span class="metric-value" id="uptime">00:00</span></div>
                <div class="metric"><span>Messages</span><span class="metric-value" id="messages-count">0</span></div>
            </div>
            
            <div class="card">
                <h2>Active Agents</h2>
                <div class="agent-list" id="agent-list">
                    <p style="color: #666; text-align: center;">No agents connected</p>
                </div>
            </div>
            
            <div class="card">
                <h2>Recent Tasks</h2>
                <div id="task-list"><p style="color: #666; text-align: center;">No tasks yet</p></div>
            </div>
            
            <div class="card">
                <h2>System Logs</h2>
                <div class="log-container" id="log-container">
                    <div class="log-entry info">[INFO] System initialized</div>
                </div>
            </div>
            
            <div class="card chat-container">
                <h2>Agent Chat</h2>
                <div class="chat-messages" id="chat-messages">
                    <div class="message">
                        <div class="message-header"><strong>System</strong><span>just now</span></div>
                        <div class="message-content">Welcome to VAI! Start a conversation with the agents.</div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="message-input" placeholder="Type your message..." onkeypress="if(event.key==='Enter')sendMessage()">
                    <button onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = window.location.origin + '/api';
        let agents = [];
        let messages = [];
        
        document.addEventListener('DOMContentLoaded', () => {
            refreshData();
            setInterval(refreshData, 5000);
        });
        
        async function refreshData() {
            try {
                const agentsRes = await fetch(`${API_BASE}/agents`);
                const agentsData = await agentsRes.json();
                if (agentsData.success) {
                    agents = agentsData.data;
                    updateAgentList(agents);
                    document.getElementById('agents-online').textContent = agents.length;
                }
                
                const statusRes = await fetch(`${API_BASE}/status`);
                const statusData = await statusRes.json();
                if (statusData.success) {
                    document.getElementById('active-tasks').textContent = statusData.data.agents_busy || 0;
                }
            } catch (err) {
                addLog(`Failed to refresh: ${err.message}`, 'error');
            }
        }
        
        function updateAgentList(agents) {
            const container = document.getElementById('agent-list');
            if (agents.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">No agents connected</p>';
                return;
            }
            container.innerHTML = agents.map(agent => `
                <div class="agent-item" onclick="selectAgent('${agent.id}')">
                    <div class="agent-avatar">${agent.name.charAt(0).toUpperCase()}</div>
                    <div class="agent-info">
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-role">${agent.role} - ${agent.capabilities.length} skills</div>
                    </div>
                    <div class="agent-status ${agent.status}"></div>
                </div>
            `).join('');
        }
        
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const content = input.value.trim();
            if (!content) return;
            
            addMessage('user', 'You', content);
            input.value = '';
            
            try {
                await fetch(`${API_BASE}/conversations/global/messages`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: content })
                });
            } catch (err) {
                addLog(`Failed to send: ${err.message}`, 'error');
            }
        }
        
        function addMessage(type, sender, content) {
            const container = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}`;
            msgDiv.innerHTML = `
                <div class="message-header"><strong>${sender}</strong><span>${new Date().toLocaleTimeString()}</span></div>
                <div class="message-content">${content.replace(/</g, '&lt;')}</div>
            `;
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
            messages.push({ type, sender, content, time: new Date() });
            document.getElementById('messages-count').textContent = messages.length;
        }
        
        function addLog(message, level = 'debug') {
            const container = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry ${level}`;
            entry.textContent = `[${level.toUpperCase()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        function createAgent() {
            const name = prompt('Enter agent name:');
            if (name) addLog(`Creating agent: ${name}`, 'info');
        }
        
        function broadcastMessage() {
            const message = prompt('Enter broadcast message:');
            if (message) addLog(`Broadcasting: ${message}`, 'info');
        }
        
        function selectAgent(agentId) {
            const agent = agents.find(a => a.id === agentId);
            if (agent) addLog(`Selected agent: ${agent.name}`, 'info');
        }
    </script>
</body>
</html>
